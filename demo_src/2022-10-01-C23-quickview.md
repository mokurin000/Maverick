---
layout: post
title: C23特性简介
slug: c23-quickview
date: 2022-10-01 17:38
status: publish
author: Poly000
categories: 
  - Programming
tags: 
  - C
  - Language_feature
---

## WIP

这篇文章正在编写。已有内容可能在近期被修改/移除

## 移除

### K&R风格函数声明与定义

比如 `int main()`，是经常被使用的旧式写法。

或者

```c
int add1(value)
int value;
{
  return value + 1;
}
```

### 其他

- 2的补码以外的有符号整数

- 不再允许`u`/`U`前缀的字符串字面量/字符常量为非UTF-16/32字符

- 混合使用宽字符连接

- 对 `realloc()` 传递0大小的调用（实现定义改为未定义）

- `__alignof_is_defined` 和 `__alignas_is_defined`

- `static_assert`宏（改为关键字）

- `thread_local`宏（改为关键字）

## 废弃

- <stdnoreturn.h>，可使用 `[[noreturn]]标志`
- `_Noreturn` 函数specifier
- `_Noreturn` 标志token

- 特性测试宏: `__STDC_IEC_559__`，`__STDC_IEC_559_COMPLEX__`，
可使用`__STDC_IEC_60559_BFP__`和`__STDC_IEC_559_COMPLEX__`。

- [`asctime()`](https://zh.cppreference.com/w/c/chrono/asctime)，可使用 `asctime_s()`

- [`ctime()`](https://zh.cppreference.com/w/c/chrono/ctime)，可使用 `ctime_s()`

- [`DECIMAL_DIG`](https://zh.cppreference.com/w/c/types/limits)，序列化/反序列化`long double`可能需要的十进制精度

- `<math.h>` 定义的数值界限（移动到 `<limits.h`）`INFINITY`，`DEC_INFINITY`，`NAN`，`DEC_NAN`

- __bool_true_false_are_defeined （现在true/false都成了关键字）

## 新语言特性

### [`十进制浮点类型`](https://zh.cppreference.com/w/c/language/arithmetic_types)

`_Decimal32`，`_Decimal64` 以及 `_Decimal128`。

详见 [IEEE定义](https://en.wikipedia.org/wiki/Decimal64_floating-point_format)。

### [属性](https://zh.cppreference.com/w/c/language/attributes)

#### [`[[deprecated]]`](https://en.cppreference.com/w/c/language/attributes/deprecated)

可以通过`("reason")`添加说明：`[[deprecated("WTH are u using this")]]`

#### [`[[fallthrough]]`](https://en.cppreference.com/w/c/language/attributes/fallthrough)

表示从这里直落是有意的，编译器不要警告。

#### [`[[maybe_unused]]`](https://en.cppreference.com/w/c/language/attributes/maybe_unused)

告诉编译器不要因为未使用警告。

#### [`[[nodiscard]]`](https://en.cppreference.com/w/c/language/attributes/nodiscard)

该类型/该函数的返回值不希望被直接丢弃。如错误信息，或者结果存储在返回值的函数。

可以通过 `("reason")`添加说明：`[[nodiscard("Error info should be processed")]]`。

#### [`[[noreturn]]`](https://en.cppreference.com/w/c/language/attributes/noreturn)

该函数不通过return语句或达到底部返回。

#### [`[[unsequenced]]`和`[[reproducible]]`](https://open-std.org/JTC1/SC22/WG14/www/docs/n2956.htm)

`[[unsequenced]]` 要求函数无状态，无副作用，幂等，并且独立。

其中：

- 无状态：没有定义可修改的静态或线程本地对象，也不调用有这种行为的函数。
- 无副作用：没有可观测的副作用。
- 幂等：重复的求值应当得到同样的结果。（可以读取全局状态）
- 独立：不依赖参数和常量以外的状态（可以写入全局变量）

`[[reproducible]]` 则只要求函数无副作用且幂等。

#### 

### 其他

- 位精度整数，[`_BitInt(N)`](https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2763.pdf)

- 二进制整数常量，以0b/0B前缀。

- `u8`前缀的 UTF-8 字符常量（u8'?'为单字节，u8"..." 为 `unsigned char [N]`）

- 数字分隔符 `'`，如 114'514'1919L

- 空初始化器 `= {}` ，同样适用于指针，整数，浮点数和自定义数据结构。

## 新标准库特性

## 参考资料

[cppreference - c23](https://en.cppreference.com/w/c/23)
